<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Meshtastic Cesium Globe</title>
  <style>
    html, body, #cesiumContainer { width: 100%; height: 100%; margin: 0; padding: 0; overflow: hidden; }
  </style>
  <link href="Cesium/Build/Cesium/Widgets/widgets.css" rel="stylesheet">
  <script src="Cesium/Build/Cesium/Cesium.js"></script>
</head>
<body>
  <div id="cesiumContainer"></div>
  <script>
    Cesium.Ion.defaultAccessToken = ''; 
    // Set up the viewer WITHOUT terrainProvider (universal)
    const offlineProvider = new Cesium.SingleTileImageryProvider({
      url: 'Cesium/assets/NaturalEarthII.jpg',
      rectangle: Cesium.Rectangle.fromDegrees(-180.0, -90.0, 180.0, 90.0)
    });
    window.viewer = new Cesium.Viewer('cesiumContainer', {
      imageryProvider: offlineProvider,
      baseLayerPicker: false,
      timeline: false,
      animation: false,
    });
    window.viewer.scene.imageryLayers.removeAll();
    window.viewer.scene.imageryLayers.addImageryProvider(offlineProvider);
  

    // Function for Meshtastic nodes
    function addOrUpdateNode(id, lat, lon, name) {
      // Check if the entity exists
      var existing = viewer.entities.getById(id);
      if (existing) {
        existing.position = Cesium.Cartesian3.fromDegrees(lon, lat);
        existing.label.text = name;
      } else {
        viewer.entities.add({
          id: id,
          position: Cesium.Cartesian3.fromDegrees(lon, lat),
          point: { pixelSize: 10, color: Cesium.Color.YELLOW },
          label: { text: name, scale: 0.5 }
        });
      }
    }

    // Try to load local tileset if it exists
    fetch('layers/myregion/tileset.json')
      .then(response => {
        if (response.ok) {
          console.log('Offline layer found! Loading...');
          return response.json();
        } else {
          throw new Error('No local layer found');
        }
      })
      .then(() => {
        const tileset = new Cesium.Cesium3DTileset({
          url: 'layers/myregion/tileset.json'
        });
        viewer.scene.primitives.add(tileset);
        viewer.zoomTo(tileset);
      })
      .catch(() => {
        console.log('Using default online imagery (no local layer found).');
      });
  </script>
</body>
</html>
